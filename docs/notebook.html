<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jes√∫s C√°ceres Tello">
<meta name="author" content="Jos√© Javier Gal√°n Hern√°ndez">
<meta name="dcterms.date" content="2025-01-01">

<title>Educational Notebook ‚Äì Open Urban Air and Meteorological Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Open Urban Air and Meteorological Data</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" target="_self"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./article.pdf" target="_blank"> <i class="bi bi-file-earmark-text" role="img">
</i> 
<span class="menu-text">Article</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./notebook.html" target="_self" aria-current="page"> <i class="bi bi-laptop" role="img">
</i> 
<span class="menu-text">Notebook</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/jcaceres-academic/OpenUrbanAirandMeteorological" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">GitHub</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> üåç Introduction</a></li>
  <li><a href="#reproducible-data-workflow" id="toc-reproducible-data-workflow" class="nav-link" data-scroll-target="#reproducible-data-workflow"><span class="header-section-number">2</span> üîÅ Reproducible Data Workflow</a></li>
  <li><a href="#data-sources-and-structure" id="toc-data-sources-and-structure" class="nav-link" data-scroll-target="#data-sources-and-structure"><span class="header-section-number">3</span> üóÇÔ∏èÔ∏è Data Sources and Structure</a>
  <ul class="collapse">
  <li><a href="#air-quality-data" id="toc-air-quality-data" class="nav-link" data-scroll-target="#air-quality-data"><span class="header-section-number">3.1</span> Air Quality Data</a></li>
  <li><a href="#pollutant-coverage" id="toc-pollutant-coverage" class="nav-link" data-scroll-target="#pollutant-coverage"><span class="header-section-number">3.2</span> Pollutant Coverage</a></li>
  <li><a href="#data-processing-workflow" id="toc-data-processing-workflow" class="nav-link" data-scroll-target="#data-processing-workflow"><span class="header-section-number">3.3</span> Data Processing Workflow</a></li>
  </ul></li>
  <li><a href="#exploratory-analysis" id="toc-exploratory-analysis" class="nav-link" data-scroll-target="#exploratory-analysis"><span class="header-section-number">4</span> üìä Exploratory Analysis</a>
  <ul class="collapse">
  <li><a href="#annual-and-seasonal-variability" id="toc-annual-and-seasonal-variability" class="nav-link" data-scroll-target="#annual-and-seasonal-variability"><span class="header-section-number">4.1</span> Annual and Seasonal Variability</a></li>
  <li><a href="#distribution-analysis" id="toc-distribution-analysis" class="nav-link" data-scroll-target="#distribution-analysis"><span class="header-section-number">4.2</span> Distribution Analysis</a></li>
  </ul></li>
  <li><a href="#forecasting-with-prophet" id="toc-forecasting-with-prophet" class="nav-link" data-scroll-target="#forecasting-with-prophet"><span class="header-section-number">5</span> üîÆ Forecasting with Prophet</a>
  <ul class="collapse">
  <li><a href="#model-for-no‚ÇÇ" id="toc-model-for-no‚ÇÇ" class="nav-link" data-scroll-target="#model-for-no‚ÇÇ"><span class="header-section-number">5.1</span> Model for NO‚ÇÇ</a></li>
  </ul></li>
  <li><a href="#meteorological-integration" id="toc-meteorological-integration" class="nav-link" data-scroll-target="#meteorological-integration"><span class="header-section-number">6</span> üå¶ Meteorological Integration</a>
  <ul class="collapse">
  <li><a href="#integration-workflow" id="toc-integration-workflow" class="nav-link" data-scroll-target="#integration-workflow"><span class="header-section-number">6.1</span> Integration Workflow</a></li>
  <li><a href="#correlation-analysis-between-pollutants-and-meteorological-variables" id="toc-correlation-analysis-between-pollutants-and-meteorological-variables" class="nav-link" data-scroll-target="#correlation-analysis-between-pollutants-and-meteorological-variables"><span class="header-section-number">6.2</span> Correlation Analysis between Pollutants and Meteorological Variables</a></li>
  </ul></li>
  <li><a href="#learning-and-reproducibility-framework" id="toc-learning-and-reproducibility-framework" class="nav-link" data-scroll-target="#learning-and-reproducibility-framework"><span class="header-section-number">7</span> üéì Learning and Reproducibility Framework</a></li>
  <li><a href="#educational-applications" id="toc-educational-applications" class="nav-link" data-scroll-target="#educational-applications"><span class="header-section-number">8</span> üßë‚Äçüè´ Educational Applications</a></li>
  <li><a href="#repository-and-citation" id="toc-repository-and-citation" class="nav-link" data-scroll-target="#repository-and-citation"><span class="header-section-number">9</span> üåê Repository and Citation</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">10</span> üìö References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Educational Notebook</h1>
<p class="subtitle lead">Citizen Science and STEM Education with R: Forecasting and Reproducible Learning from Open Urban Air Quality Data</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Jes√∫s C√°ceres Tello <a href="mailto:jcaceres.academic@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Universidad Complutense de Madrid
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Jos√© Javier Gal√°n Hern√°ndez <a href="mailto:jose.galan@uah.es" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Universidad Complutense de Madrid
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">
  <img src="https://img.shields.io/badge/License-CC%20BY%204.0-lightgrey.svg" alt="License CC BY 4.0">
</a>
<a href="https://www.r-project.org/" target="_blank" rel="noopener">
  <img src="https://img.shields.io/badge/Made%20with-R-blue.svg" alt="Made with R">
</a>
<a href="https://quarto.org/" target="_blank" rel="noopener">
  <img src="https://img.shields.io/badge/Rendered_with-Quarto-4A90E2.svg" alt="Rendered with Quarto">
</a>
<a href="https://doi.org/10.3390/app152212183" target="_blank" rel="noopener">
  <img src="https://img.shields.io/badge/DOI-10.3390%2Fapp152212183-blue.svg" alt="DOI 10.3390/app152212183">
</a>
<a href="https://www.zotero.org/groups/6375403/appliedsciences-2025" target="_blank" rel="noopener">
  <img src="https://img.shields.io/badge/Zotero-Applied%20Sciences--2025-red.svg" alt="Zotero Applied Sciences 2025">
</a>

<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> üåç Introduction</h1>
<p>This notebook complements the article <em>Citizen Science and STEM Education with R: AI‚ÄìIoT Forecasting and Reproducible Learning from Open Urban Air Quality Data</em><br>
(Applied Sciences, 2025) and includes reproducible code examples, data harmonisation workflows, and visualisations.</p>
<p>It reproduces the main analytical workflow implemented in the study and illustrates how R and Quarto can be integrated into <strong>STEM education</strong> to foster data literacy, environmental awareness, and methodological transparency.</p>
<hr>
</section>
<section id="reproducible-data-workflow" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> üîÅ Reproducible Data Workflow</h1>
<p>The complete workflow integrates <strong>open data</strong>, <strong>computational reproducibility</strong>, and <strong>STEM learning</strong>.<br>
It can be applied to other urban contexts or courses focusing on environmental informatics, statistical modelling, or sustainability transitions.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fig1_Open_Data_and_Methodological_Pipeline.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 1. Open Data and Methodological Pipeline.</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="data-sources-and-structure" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> üóÇÔ∏èÔ∏è Data Sources and Structure</h1>
<section id="air-quality-data" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="air-quality-data"><span class="header-section-number">3.1</span> Air Quality Data</h2>
<p>Air quality datasets were retrieved from the <strong>Madrid Open Data Portal</strong> (<em>Portal de Datos Abiertos del Ayuntamiento de Madrid</em>).<br>
Measurements include nitrogen dioxide (NO‚ÇÇ), ozone (O‚ÇÉ), particulate matter (PM‚ÇÅ‚ÇÄ, PM‚ÇÇ.‚ÇÖ), sulphur dioxide (SO‚ÇÇ), and carbon monoxide (CO) recorded hourly across 24 urban stations (2020‚Äì2024).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fig2a_Mapa_Madrid_Final_v7_3.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 2a. Air quality monitoring stations across the Madrid urban area (2020‚Äì2024).</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="pollutant-coverage" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="pollutant-coverage"><span class="header-section-number">3.2</span> Pollutant Coverage</h2>
<p>Each station has different pollutant coverage and measurement frequency, which provides an excellent example for students to explore data completeness and measurement uncertainty in open environmental datasets.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fig2b_Bar_Coverage.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 2b. Pollutant coverage and measurement frequency across monitoring stations.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="data-processing-workflow" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="data-processing-workflow"><span class="header-section-number">3.3</span> Data Processing Workflow</h2>
<p>Data from both sources were processed in R through three main stages:</p>
<ol type="1">
<li>Reading and cleaning monthly CSVs (removing redundant columns and correcting data types).<br>
</li>
<li>Validating records with confirmed measurements (<code>VAL</code> flag).<br>
</li>
<li>Pivoting and compressing results into <code>parquet</code> format for efficiency and consistency.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fig3_Data_Pipeline.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 3. Data acquisition, validation, and harmonisation workflow implemented in R.</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="exploratory-analysis" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> üìä Exploratory Analysis</h1>
<p>This section presents an exploratory analysis of key urban air pollutants using open environmental data. The aim is to characterise the temporal variability and distributional properties of NO‚ÇÇ and O‚ÇÉ as a basis for subsequent modelling and correlation analyses. Exploratory statistics are used to identify long-term trends, seasonal patterns, and interannual variability relevant for urban air quality dynamics.</p>
<section id="annual-and-seasonal-variability" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="annual-and-seasonal-variability"><span class="header-section-number">4.1</span> Annual and Seasonal Variability</h2>
<p>Figure 4 shows the annual variability of daily mean <strong>NO‚ÇÇ</strong> and <strong>O‚ÇÉ</strong> concentrations over the 2020‚Äì2024 period. NO‚ÇÇ concentrations display relatively stable distributions with a slight reduction in median values in the most recent years. In contrast, O‚ÇÉ exhibits higher dispersion and a progressive increase in median and upper-range concentrations, reflecting its pronounced seasonal behaviour.</p>
<p>Overall, the boxplots highlight distinct distributional patterns between the primary pollutant (<strong>NO‚ÇÇ</strong>) and the secondary pollutant (<strong>O‚ÇÉ</strong>), providing a descriptive baseline for the subsequent correlation and modelling analyses.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fig4_NO2_O3_Annual_Variability.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 4. Annual variability of NO‚ÇÇ and O‚ÇÉ concentrations (2020‚Äì2024).</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="distribution-analysis" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="distribution-analysis"><span class="header-section-number">4.2</span> Distribution Analysis</h2>
<p>Boxplots provide a powerful visual tool to discuss dispersion, central tendency, and outliers across pollutants.<br>
In this context, students learn how descriptive statistics translate into environmental interpretation, reinforcing quantitative reasoning with real data.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Figure8_Boxplots_NO2_O3_2020_2024.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 8. Boxplots of NO‚ÇÇ and O‚ÇÉ concentrations across 2020‚Äì2024.</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="forecasting-with-prophet" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> üîÆ Forecasting with Prophet</h1>
<p>Time-series forecasting introduces students to predictive modelling using open environmental data.<br>
The <strong>Prophet model</strong> (Taylor &amp; Letham, 2018) was selected for its interpretability, decomposition structure, and robustness to missing values ‚Äî key features for teaching reproducible forecasting in R.</p>
<section id="model-for-no‚ÇÇ" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="model-for-no‚ÇÇ"><span class="header-section-number">5.1</span> Model for NO‚ÇÇ</h2>
<p>Students can visualise how additive components ‚Äî trend, seasonality, and residuals ‚Äî reveal the influence of human activity and meteorological cycles on pollutant evolution. This exercise supports reproducible experimentation with forecasting horizons, cross-validation, and performance metrics such as RMSE or MAE.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fig5a_Prophet_NO2_F.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 5a. Prophet forecast for NO‚ÇÇ concentrations (2020‚Äì2024).</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fig5b_Prophet_O3_F.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 5b. Prophet forecast for O‚ÇÉ concentrations (2020‚Äì2024).</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="meteorological-integration" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> üå¶ Meteorological Integration</h1>
<p>Meteorological factors shape pollutant behaviour and are fundamental in understanding atmospheric processes.<br>
By integrating temperature, solar radiation, and wind speed data from <strong>AEMET</strong>, learners can explore multivariate relationships within an urban ecosystem.</p>
<section id="integration-workflow" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="integration-workflow"><span class="header-section-number">6.1</span> Integration Workflow</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fig7_Meteorological_Data_Integration_Workflow_2020_2024.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 7. Integration workflow of meteorological and air quality data (2020‚Äì2024).</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-analysis-between-pollutants-and-meteorological-variables" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="correlation-analysis-between-pollutants-and-meteorological-variables"><span class="header-section-number">6.2</span> Correlation Analysis between Pollutants and Meteorological Variables</h2>
<p>To complement the integration workflow, this section computes the <strong>Spearman correlations</strong> between daily concentrations of NO‚ÇÇ and O‚ÇÉ and six meteorological parameters (temperature, relative humidity, wind speed, solar radiation, atmospheric pressure, and precipitation) using the validated datasets (2020‚Äì2024).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Cargar y combinar archivos anuales ---</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>air_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/Calidad del Aire_Parquet"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"aire_validados_.*</span><span class="sc">\\</span><span class="st">.parquet$"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>met_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/Meteorologia_Parquet"</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"meteo_validados_.*</span><span class="sc">\\</span><span class="st">.parquet$"</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>air <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(air_files, read_parquet)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>met <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(met_files, read_parquet)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Crear variable diaria ---</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>air <span class="ot">&lt;-</span> air <span class="sc">%&gt;%</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(FECHA_HORA))</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>met <span class="ot">&lt;-</span> met <span class="sc">%&gt;%</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(FECHA_HORA))</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Agregar diariamente y pivotar a formato ancho ---</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>air_wide <span class="ot">&lt;-</span> air <span class="sc">%&gt;%</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MAGNITUD =</span> <span class="fu">as.character</span>(MAGNITUD)) <span class="sc">%&gt;%</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, MAGNITUD) <span class="sc">%&gt;%</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">valor =</span> <span class="fu">mean</span>(VALOR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> MAGNITUD, <span class="at">values_from =</span> valor)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>met_wide <span class="ot">&lt;-</span> met <span class="sc">%&gt;%</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MAGNITUD =</span> <span class="fu">as.character</span>(MAGNITUD)) <span class="sc">%&gt;%</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, MAGNITUD) <span class="sc">%&gt;%</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">valor =</span> <span class="fu">mean</span>(VALOR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> MAGNITUD, <span class="at">values_from =</span> valor)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. Unir por fecha ---</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>data_joined <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(air_wide, met_wide, <span class="at">by =</span> <span class="st">"date"</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Renombrar magnitudes (solo las que existen) ---</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>data_joined <span class="ot">&lt;-</span> data_joined <span class="sc">%&gt;%</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">recode</span>(</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>      .x,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">8</span><span class="st">`</span>  <span class="ot">=</span> <span class="st">"NO2"</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">14</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"O3"</span>,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">81</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"WS"</span>,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">83</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"T"</span>,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">85</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"PRES"</span>,</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">86</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"RH"</span>,</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">87</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"SR"</span>,</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">89</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"PREC"</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">intersect</span>(</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(data_joined),</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"8"</span>, <span class="st">"14"</span>, <span class="st">"81"</span>, <span class="st">"83"</span>, <span class="st">"85"</span>, <span class="st">"86"</span>, <span class="st">"87"</span>, <span class="st">"89"</span>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6. Calcular correlaciones de Spearman (robusto) ---</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"NO2"</span>, <span class="st">"O3"</span>, <span class="st">"T"</span>, <span class="st">"RH"</span>, <span class="st">"WS"</span>, <span class="st">"SR"</span>, <span class="st">"PRES"</span>, <span class="st">"PREC"</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> data_joined <span class="sc">%&gt;%</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(vars)) <span class="sc">%&gt;%</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">"spearman"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">focus</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">"NO2"</span>, <span class="st">"O3"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(term)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 7. Mostrar tabla formateada ---</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  cor_matrix <span class="sc">%&gt;%</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">2</span>))),</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Table 4. Spearman correlation coefficients (œÅ) between daily pollutant concentrations and meteorological variables (2020‚Äì2024)."</span>,</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"NO‚ÇÇ"</span>, <span class="st">"O‚ÇÉ"</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 4. Spearman correlation coefficients (œÅ) between daily pollutant concentrations and meteorological variables (2020‚Äì2024).</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">NO‚ÇÇ</th>
<th style="text-align: right;">O‚ÇÉ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PREC</td>
<td style="text-align: right;">-0.18</td>
<td style="text-align: right;">-0.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">RH</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">-0.70</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SR</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">-0.46</td>
</tr>
<tr class="even">
<td style="text-align: left;">T</td>
<td style="text-align: right;">-0.35</td>
<td style="text-align: right;">0.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WS</td>
<td style="text-align: right;">-0.75</td>
<td style="text-align: right;">0.57</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
</section>
<section id="learning-and-reproducibility-framework" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> üéì Learning and Reproducibility Framework</h1>
<p>Reproducibility is both a scientific and pedagogical value.<br>
This framework unifies open data, transparent computation, and educational innovation, reinforcing the culture of <strong>open science</strong>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fig6_Learning_Reproducibility_Ecosystem.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Fig. 6. Reproducible learning and open-science framework for STEM education.</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="educational-applications" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> üßë‚Äçüè´ Educational Applications</h1>
<p>This Notebook can be directly incorporated into undergraduate or postgraduate STEM courses focused on data analysis, environmental informatics, or sustainability.</p>
<p><strong>Suggested learning activities:</strong> 1. Reproduce pollutant forecasts with modified training periods.<br>
2. Explore correlations between additional meteorological variables.<br>
3. Design inquiry-based projects connecting data to local environmental policies.<br>
4. Document and publish reproducible reports using Quarto and GitHub.</p>
<p>Through these exercises, students not only practise coding but also embrace scientific integrity and civic engagement through data.</p>
<hr>
</section>
<section id="repository-and-citation" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> üåê Repository and Citation</h1>
<p>All code, figures, and harmonised datasets are openly available at:<br>
<a href="https://github.com/jcaceres-academic/OpenUrbanAirandMeteorological" class="uri">https://github.com/jcaceres-academic/OpenUrbanAirandMeteorological</a></p>
<p>When citing this educational resource, please use:</p>
<blockquote class="blockquote">
<p>C√°ceres-Tello, J., Gal√°n-Hern√°ndez, J. J., Morales Cevallo, M. B., &amp; L√≥pez-Meneses, E. (2025). Citizen Science and STEM Education with R: AI‚ÄìIoT Forecasting and Reproducible Learning from Open Urban Air Quality &gt;Data. Applied Sciences, 15(22), 12183. https://doi.org/10.3390/app152212183</p>
</blockquote>
<p>This ensures traceability and recognition for open-source academic contributions.</p>
<hr>
</section>
<section id="references" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> üìö References</h1>
<p>All cited works are managed through the shared bibliographic file <a href="../applsci-3979500.bib"><code>applsci-3979500.bib</code></a>, which includes all references used in the manuscript and notebook.<br>
A public mirror of this bibliography is archived in the author‚Äôs Zotero collection:<br>
‚û°Ô∏è <a href="https://www.zotero.org/jcaceres_academic/collections/X6RW9UGU" class="uri">https://www.zotero.org/jcaceres_academic/collections/X6RW9UGU</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jcaceres-academic\.github\.io\/OpenUrbanAirandMeteorological\/index\.html");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>