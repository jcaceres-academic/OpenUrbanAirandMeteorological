---
title: "Citizen Science and STEM Education with R"
subtitle: "Teaching and Research Companion Notebook ‚Äî Open Urban Air Data from Madrid (2020‚Äì2024)"
author:
  - name: "Jes√∫s C√°ceres Tello"
    affiliation: "Faculty of Computer Science, Complutense University of Madrid"
    email: "jescacer@ucm.es"
  - name: "Jos√© Javier Gal√°n Hern√°ndez"
    affiliation: "Dpto. Computer Science, University of Alcal√°"
    email: "jose.galan@uah.es"
format:
  html:
    theme: cosmo
    toc: true
    toc-title: "Contents"
    toc-location: left
    number-sections: true
    page-layout: full
engine: knitr
execute:
  echo: false
  warning: false
  message: false
  working-directory: ".."
title-block-style: default
title-block-banner: false
---

# üí° Purpose of the Notebook

This Quarto Notebook serves as a **teaching and research companion** to the article\
*Citizen Science and STEM Education with R: Reproducible Learning from Open Urban Air Quality Data* (Applied Sciences, 2025).

It reproduces the main analytical workflow implemented in the study and illustrates how R and Quarto can be integrated into **STEM education** to foster data literacy, environmental awareness, and methodological transparency.

------------------------------------------------------------------------

# Reproducible Data Workflow

The complete workflow integrates **open data**, **computational reproducibility**, and **STEM learning**.\
It can be applied to other urban contexts or courses focusing on environmental informatics, statistical modelling, or sustainability transitions.

```{r fig1-pipeline, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 1. Open Data and Methodological Pipeline.'}
knitr::include_graphics("images/Fig1_Open_Data_and_Methodological_Pipeline.png")

```

------------------------------------------------------------------------

# üóÇÔ∏èÔ∏è Data Sources and Structure

## Air Quality Data

Air quality datasets were retrieved from the **Madrid Open Data Portal** (*Portal de Datos Abiertos del Ayuntamiento de Madrid*).\
Measurements include nitrogen dioxide (NO‚ÇÇ), ozone (O‚ÇÉ), particulate matter (PM‚ÇÅ‚ÇÄ, PM‚ÇÇ.‚ÇÖ), sulphur dioxide (SO‚ÇÇ), and carbon monoxide (CO) recorded hourly across 24 urban stations (2020‚Äì2024).

```{r fig2a-map, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 2a. Air quality monitoring stations across the Madrid urban area (2020‚Äì2024).'}
knitr::include_graphics("images/Fig2a_Mapa_Madrid_Final_v7_3.png")

```

## Pollutant Coverage

Each station has different pollutant coverage and measurement frequency, which provides an excellent example for students to explore data completeness and measurement uncertainty in open environmental datasets.

```{r fig2b-coverage, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 2b. Pollutant coverage and measurement frequency across monitoring stations.'}
knitr::include_graphics("images/Fig2b_Bar_Coverage.png")
```

## Data Processing Workflow

Data from both sources were processed in R through three main stages:  

1. Reading and cleaning monthly CSVs (removing redundant columns and correcting data types).  
2. Validating records with confirmed measurements (`VAL` flag).  
3. Pivoting and compressing results into `parquet` format for efficiency and consistency.

```{r fig3-pipeline, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 3. Data acquisition, validation, and harmonisation workflow implemented in R.'}
knitr::include_graphics("images/Fig3_Data_Pipeline.png")
```

---

# üìä Exploratory Analysis


Exploratory analysis introduces students to descriptive statistics and visual analytics in R using open environmental data.  
The focus is on **NO‚ÇÇ** (a primary traffic-related pollutant) and **O‚ÇÉ** (a secondary pollutant formed photochemically), both key indicators of urban air quality dynamics.

```{r fig4-variability, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 4. Annual variability of NO‚ÇÇ and O‚ÇÉ concentrations (2020‚Äì2024).'}
knitr::include_graphics("images/Fig4_NO2_O3_Annual_Variability.png")
```

## Annual and Seasonal Variability

```{r fig4-variability, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 4. Annual variability of NO‚ÇÇ and O‚ÇÉ concentrations (2020‚Äì2024).'}
knitr::include_graphics("images/Fig4_NO2_O3_Annual_Variability.png")
```

## Distribution Analysis
Boxplots provide a powerful visual tool to discuss dispersion, central tendency, and outliers across pollutants.  
In this context, students learn how descriptive statistics translate into environmental interpretation, reinforcing quantitative reasoning with real data.

```{r fig8-boxplots, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 8. Boxplots of NO‚ÇÇ and O‚ÇÉ concentrations across 2020‚Äì2024.'}
knitr::include_graphics("images/Figure8_Boxplots_NO2_O3_2020_2024.png")
```


---

#üîÆ Forecasting with Prophet

Time-series forecasting introduces students to predictive modelling using open environmental data.  
The **Prophet model** (Taylor & Letham, 2018) was selected for its interpretability, decomposition structure, and robustness to missing values ‚Äî key features for teaching reproducible forecasting in R.

## Model for NO‚ÇÇ

Students can visualise how additive components ‚Äî trend, seasonality, and residuals ‚Äî reveal the influence of human activity and meteorological cycles on pollutant evolution.
This exercise supports reproducible experimentation with forecasting horizons, cross-validation, and performance metrics such as RMSE or MAE.

```{r fig5a-prophet-no2, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 5a. Prophet forecast for NO‚ÇÇ concentrations (2020‚Äì2024).'}
knitr::include_graphics("images/Fig5a_Prophet_NO2_F.png")
knitr::include_graphics("images/Fig5b_Prophet_O3_F.png")
```


