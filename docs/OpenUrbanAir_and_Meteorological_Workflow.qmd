---
title: "Citizen Science and STEM Education with R"
subtitle: "Teaching and Research Companion Notebook â€” Open Urban Air Data from Madrid (2020â€“2024)"
author:
  - name: "JesÃºs CÃ¡ceres Tello"
    affiliation: "Department of Computer Science and Engineering, Complutense University of Madrid"
    email: "jescacer@ucm.es"
  - name: "JosÃ© Javier GalÃ¡n HernÃ¡ndez"
    affiliation: "Dpto. Computer Science, University of AlcalÃ¡"
    email: "jose.galan@uah.es"
format:
  html:
    theme: cosmo
    toc: true
    toc-title: "Contents"
    toc-location: left
    number-sections: true
    page-layout: full
    css: styles.css
engine: knitr
execute:
  echo: false
  warning: false
  message: false
  working-directory: ".."
title-block-style: default
title-block-banner: false
bibliography: "references.bib"
csl: "apa.csl"
---

# ðŸ’¡ Purpose of the Notebook

This Quarto Notebook serves as a **teaching and research companion** to the article\
*Citizen Science and STEM Education with R: Reproducible Learning from Open Urban Air Quality Data* (Applied Sciences, 2025).

It reproduces the main analytical workflow implemented in the study and illustrates how R and Quarto can be integrated into **STEM education** to foster data literacy, environmental awareness, and methodological transparency.

------------------------------------------------------------------------

# ðŸ” Reproducible Data Workflow

The complete workflow integrates **open data**, **computational reproducibility**, and **STEM learning**.\
It can be applied to other urban contexts or courses focusing on environmental informatics, statistical modelling, or sustainability transitions.


```{r fig1-pipeline, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 1. Open Data and Methodological Pipeline.'}
knitr::include_graphics("images/Fig1_Open_Data_and_Methodological_Pipeline.png")

```

------------------------------------------------------------------------

# ðŸ—‚ï¸ï¸ Data Sources and Structure

## Air Quality Data

Air quality datasets were obtained from the **Madrid Open Data Portal** (*Portal de Datos Abiertos del Ayuntamiento de Madrid*).  
These include hourly measurements for the period **2020â€“2024**, covering major urban pollutants:

- Nitrogen dioxide (**NOâ‚‚**)  
- Ozone (**Oâ‚ƒ**)  
- Particulate matter (**PMâ‚â‚€**, **PMâ‚‚.â‚…**)  
- Sulphur dioxide (**SOâ‚‚**)  
- Carbon monoxide (**CO**)

Twenty-four urban monitoring stations distributed across the metropolitan area provide these observations, enabling both **spatial** and **temporal** analysis.


```{r fig2a-map, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 2a. Air quality monitoring stations across the Madrid urban area (2020â€“2024).'}
knitr::include_graphics("images/Fig2a_Mapa_Madrid_Final_v7_3.png")

```

## Pollutant Coverage

Each monitoring station is characterised by its specific set of measured pollutants and sampling frequency.  
This diversity in sensor configuration offers an ideal opportunity for students to analyse **coverage heterogeneity**, **data completeness**, and **measurement uncertainty** within open environmental datasets.

```{r fig2b-coverage, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 2b. Pollutant coverage and measurement frequency across monitoring stations.'}
knitr::include_graphics("images/Fig2b_Bar_Coverage.png")
```

## Data Processing Workflow

The transformation from raw CSV files to harmonised analytical datasets followed a **reproducible pipeline implemented entirely in R**.  
This process illustrates how open environmental data can be systematically prepared for both **scientific research** and **STEM learning**.

The workflow consisted of **three main stages**:

1. **Data cleaning and type correction** â€” Monthly CSVs were read, redundant columns removed, and measurement units harmonised.  
2. **Validation of observations** â€” Only records with confirmed and validated readings (flagged as `VAL`) were retained to ensure data integrity.  
3. **Restructuring and optimisation** â€” The validated data were **pivoted** from long to wide format and exported as **Parquet files**, improving reproducibility and computational efficiency for later analyses.

This modular approach helps students visualise the logic of **data provenance**, encouraging transparency and best practices in open science.

```{r fig3-pipeline, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 3. Data acquisition, validation, and harmonisation workflow implemented in R.'}
knitr::include_graphics("images/Fig3_Data_Pipeline.png")
```

---

# ðŸ“Š Exploratory Analysis

Exploratory analysis introduces students to **descriptive statistics** and **visual analytics** in R using open environmental data.  
The focus is on two key pollutants:

- **Nitrogen dioxide (NOâ‚‚)** â€” a primary pollutant linked to traffic emissions.  
- **Ozone (Oâ‚ƒ)** â€” a secondary pollutant formed photochemically from NOâ‚“ and VOCs.  

Together, these illustrate how human activity and atmospheric chemistry interact within urban ecosystems.

## Annual and Seasonal Variability

The temporal evolution of **NOâ‚‚** and **Oâ‚ƒ** across 2020â€“2024 reflects distinct **seasonal and annual cycles** driven by emission patterns and meteorological factors.  
Students can observe that NOâ‚‚ concentrations tend to peak in winter due to traffic density and atmospheric stability, whereas Oâ‚ƒ levels rise in summer as a result of higher solar radiation and photochemical activity.

This comparative behaviour offers an engaging opportunity to discuss how **urban dynamics**, **weather variability**, and **chemical processes** interact in shaping local air quality.

```{r fig4-variability, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 4. Annual variability of NOâ‚‚ and Oâ‚ƒ concentrations (2020â€“2024).'}
knitr::include_graphics("images/Fig4_NO2_O3_Annual_Variability.png")
```

## Distribution Analysis
Boxplots provide an intuitive and effective way to examine **dispersion**, **central tendency**, and **extreme values** across pollutants.  
By comparing distributions of **NOâ‚‚** and **Oâ‚ƒ**, students can identify seasonal contrasts, interannual variability, and potential anomalies that reflect real-world emission dynamics.

This section bridges **statistical literacy** and **environmental understanding**, showing how descriptive indicators translate into meaningful interpretations of urban air quality.


```{r fig8-boxplots, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 8. Boxplots of NOâ‚‚ and Oâ‚ƒ concentrations across 2020â€“2024.'}
knitr::include_graphics("images/Figure8_Boxplots_NO2_O3_2020_2024.png")
```


---

# ðŸ”® Forecasting with Prophet

Time-series forecasting introduces students to **predictive modelling** and **temporal decomposition** using open environmental data.  
The **Prophet model** (Taylor & Letham, 2018) was selected for its interpretability, transparent structure, and robustness to missing values â€” essential features when teaching **reproducible forecasting** in R.

Prophet decomposes a time series into three additive components:
- **Trend** â€” long-term evolution of pollutant levels.  
- **Seasonality** â€” recurring intra-annual fluctuations driven by meteorological and behavioural factors.  
- **Residuals** â€” short-term deviations related to random or episodic events.

This section helps students explore **how patterns evolve over time**, interpret the **drivers of air quality**, and experiment with **forecast horizons** and **validation strategies** (e.g., RMSE, MAE).

---

## ðŸŒ† Model for NOâ‚‚

The NOâ‚‚ series reflects anthropogenic influence, particularly road traffic and winter meteorological inversions.  
Students can visualise how the Prophet model isolates these periodic and structural patterns, highlighting long-term decline and seasonal peaks.


```{r fig5a-prophet-no2, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 5a. Prophet forecast for NOâ‚‚ concentrations (2020â€“2024).'}
knitr::include_graphics("images/Fig5a_Prophet_NO2_F.png")
```

## ðŸŒ¤ Model for Oâ‚ƒ

Ozone concentrations display the opposite behaviour â€” increasing in summer under high solar radiation.
Prophet effectively captures the photochemical formation dynamics and seasonal oscillations, reinforcing the complementarity between NOâ‚‚ and Oâ‚ƒ.

```{r fig5b-prophet-O3, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 5b. Prophet forecast for Oâ‚ƒ concentrations (2020â€“2024).'}
knitr::include_graphics("images/Fig5b_Prophet_O3_F.png")
```

---

# ðŸŒ¦ Meteorological Integration

Meteorological factors critically influence the behaviour, transformation, and dispersion of air pollutants.  
Integrating **meteorological variables**â€”temperature, solar radiation, humidity, and wind speedâ€”from **AEMET** allows students to explore the coupled dynamics between atmospheric conditions and air quality indicators.

This integration exemplifies how open data from different institutions can be harmonised into a single reproducible analytical framework.  
By analysing these variables together, learners understand how **synoptic patterns** and **urban microclimates** shape pollutant variability.


## Integration Workflow

The following workflow summarises the harmonisation of meteorological and air-quality datasets.  
It demonstrates how data alignment, temporal aggregation, and joint visualisation enable multivariate environmental analysis in R.

```{r fig7-meteo, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 7. Integration workflow of meteorological and air quality data (2020â€“2024).'}
knitr::include_graphics("images/Fig7_Meteorological_Data_Integration_Workflow_2020_2024.png")
```

---

# ðŸŽ“ Learning and Reproducibility Framework

Reproducibility is both a **scientific principle** and a **pedagogical value**.  
This framework connects open data, transparent computation, and reflective learning â€” empowering students to move from *data consumers* to *data producers* within a reproducible workflow.

Through R and Quarto, learners gain not only coding skills but also an understanding of how reproducibility sustains credibility and collaboration in science.  
The visual framework below represents the **ecosystem of reproducible learning**, where environmental data analysis becomes an educational strategy for open, inquiry-based STEM education.

```{r fig6-learning, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 6. Reproducible learning and open-science framework for STEM education.'}
knitr::include_graphics("images/Fig6_Learning_Reproducibility_Ecosystem.png")
```

---

# ðŸŒ€ Spatio-Temporal Variability and Atmospheric Drivers

Understanding pollutant variability across **time** and **space** provides a crucial bridge between descriptive analysis and causal interpretation.  
This section integrates the temporal and spatial dimensions of air quality, followed by their linkage with meteorological variables that modulate pollutant dynamics in the urban atmosphere.

---

## â± Temporal and Spatial Variability

The temporal evolution of NOâ‚‚ and Oâ‚ƒ between 2020â€“2024 shows clear annual cycles and gradual post-pandemic recovery patterns.  
Spatially, concentrations differ by **station type** (urban-traffic, suburban, background), reflecting local emission sources and micro-meteorological effects.

```{r fig9-variability, echo=FALSE, fig.align='center', out.width='90%', fig.cap='Fig. 9. Temporal and spatial variability of NOâ‚‚ and Oâ‚ƒ across Madrid monitoring stations (2020â€“2024).'}
knitr::include_graphics("images/Figure9_Temporal_Spatial_Variability.png")
```

---

# ðŸŒ¦ Meteorological Influence

Meteorological conditions strongly influence pollutant dynamics by shaping transport, dispersion, and chemical transformation processes.  
Within the urban boundary layer, parameters such as **temperature**, **wind speed**, **humidity**, **solar radiation**, **pressure**, and **precipitation** determine how NOâ‚‚ and Oâ‚ƒ interact over time.

This section helps students explore the **coupled variability** between pollutants and meteorological drivers, reinforcing the interdisciplinary nature of environmental data analysis in R.

```{r fig10-meteo, echo=FALSE, fig.align='center', out.width='95%', fig.cap='Fig. 10. Coupled variability of NOâ‚‚ and Oâ‚ƒ with meteorological variables (2020â€“2024).'}
knitr::include_graphics("images/Fig10_NO2_O3_vs_Meteorology.png")
```

---

# ðŸ§‘â€ðŸ« Educational Applications

Within this framework, **reproducibility** acts as a bridge between academic rigour and educational innovation.  
It transforms the learning process into a participatory and evidence-based experience, connecting environmental science, data analysis, and civic engagement.

**Core educational dimensions:**

- ðŸ” **Transparency** â€” All analyses and visualisations can be replicated, modified, and extended.  
- ðŸŒ **Engagement** â€” Students explore socially relevant, real-world datasets on urban air quality and sustainability.  
- ðŸ’¡ **Open pedagogy** â€” Scripts, notebooks, and outputs are shared openly, fostering peer learning and collaboration.  
- ðŸ§  **Skill transfer** â€” Learners develop competences in R, data science, and environmental interpretation.  
- ðŸª´ **Scientific integrity** â€” Each analytical decision is documented, reinforcing traceability and accountability in research.

This integrative approach nurtures a culture of **openness and reproducibility**, aligning STEM education with the broader movement of **Open Science** and **citizen participation**.  
By engaging with real environmental data, students transition from passive consumers of information to active contributors in the pursuit of sustainable urban futures.

---

# ðŸŒ Repository and Citation

All code, figures, and harmonised datasets used in this notebook are openly available in the companion GitHub repository:  
[ðŸ”— OpenUrbanAirandMeteorological â€” GitHub Repository](https://github.com/jcaceres-academico/OpenUrbanAirandMeteorological)

This repository guarantees **transparency**, **traceability**, and **reusability** of all materials developed in the study, enabling reproducible and educational reuse in R and Quarto.

When citing this notebook or the associated research article, please use the following citation (APA 7th Edition):

> [@Caceres2025]

---

ðŸ’¾ **Repository contents**

- `docs/` â€” Quarto notebook (`.qmd`) and rendered HTML output  
- `docs/images/` â€” Figures (PNG) used throughout the notebook  
- `scripts/` â€” R scripts for preprocessing, harmonisation, and analysis  
- `.gitignore` â€” Files and folders excluded from version control  
- `LICENSE` â€” Open access and reuse terms  
- `README.md` â€” Project overview and structure  

---

This open repository embodies the principles of **Open Science**, promoting transparency, collaboration, and reproducibility in environmental research and STEM education.  

By sharing both data and methodology, the project supports a global community of educators, students, and researchers committed to data-driven sustainability.